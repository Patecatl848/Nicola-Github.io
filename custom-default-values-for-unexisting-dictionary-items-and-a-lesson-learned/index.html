<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Custom default values for unexisting dictionary items (and a lesson learned)"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Custom default values for unexisting dictionary items (and a lesson learned) &middot; Nicola Iarocci" />
  	<meta property="og:site_name" content="Nicola Iarocci" />
  	<meta property="og:url" content="https://nicolaiarocci.com/custom-default-values-for-unexisting-dictionary-items-and-a-lesson-learned/" />

    
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-06-11T07:05:25&#43;01:00" />

    
    <meta property="article:tag" content="til" />
    
    <meta property="article:tag" content="dotnet" />
    
    <meta property="article:tag" content="programming" />
    
    

    <title>Custom default values for unexisting dictionary items (and a lesson learned) &middot; Nicola Iarocci</title>

    
    <meta name="description" content="When dealing with dictionaries, a typical problem is what to do when an operation attempts to retrieve an element using a key that does not exist in the diction" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    <link rel="stylesheet" href="/css/custom.css">
    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Nicola Iarocci" />
      
      
    
    <meta name="generator" content="Hugo 0.55.4" />

    <link rel="canonical" href="https://nicolaiarocci.com/custom-default-values-for-unexisting-dictionary-items-and-a-lesson-learned/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null ,
        "logo": "https://nicolaiarocci.com/images/avatar.png"
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "image": {
            "@type": "ImageObject",
            "url": "https://nicolaiarocci.com/images/avatar.png",
            "width": 250,
            "height": 250
        }, 
        
        "url": "https://nicolaiarocci.com",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "Custom default values for unexisting dictionary items (and a lesson learned)",
    "name": "Custom default values for unexisting dictionary items (and a lesson learned)",
    "wordCount":  438 ,
    "timeRequired": "PT3M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "https://nicolaiarocci.com/custom-default-values-for-unexisting-dictionary-items-and-a-lesson-learned/",
    "datePublished": "2021-06-11T07:05Z",
    "dateModified": "2021-06-11T07:05Z",
    
    "keywords": "til, dotnet, programming",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://nicolaiarocci.com/custom-default-values-for-unexisting-dictionary-items-and-a-lesson-learned/"
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-19006041-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/opensource">Open Source</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/speaking">Speaking</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/books-i-have-read">Reading</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/il-piccolo-libro-di-mongodb-edizione-italiana">MongoDB</a>
            </li>
        
            <h3>Subscribe</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://nicolaiarocci.substack.com">Newsletter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nicolaiarocci.com/index.xml">RSS feed</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/nicolaiarocci">Twitter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/nicolaiarocci">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://stackoverflow.com/users/323269/nicola-iarocci?tab=profile">Stack Overflow</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://speakerdeck.com/u/nicola">Speaker Deck</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://www.linkedin.com/in/nicolaiarocci">LinkedIn</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="https://nicolaiarocci.com/"><img src="/images/avatar.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Custom default values for unexisting dictionary items (and a lesson learned)</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2021-06-11T07:05:25&#43;01:00">
            Jun 11, 2021
          </time>
        
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/til/">#til</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/dotnet/">#dotnet</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/programming/">#programming</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p>When dealing with dictionaries, a typical problem is what to do when an
operation attempts to retrieve an element using a key that does not exist in
the dictionary. In .NET, a <code>KeyNotFoundException</code> is raised, and that&rsquo;s the
desired behaviour in most circumstances. Sometimes, however, you know that your
program will frequently try to retrieve keys that do not exist. In such cases,
it is more efficient to use the <code>TryGetValue</code> method:</p>

<blockquote>
<p>This method returns the value associated with the specified key, if the key
is found; otherwise, the default value for the type of the value parameter is
returned (<a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.trygetvalue?view=net-5.0">source</a>)</p>
</blockquote>

<p>The devil hides in details. <code>TryGetValue</code> returns the default value for the
type of the <code>value</code> parameter. So, if you use <code>TryGetValue</code> to look into
a dictionary of strings, <code>null</code> is returned on a missing key. That is probably
ok in most cases. Howewer, if your logic requires a custom default value
instead, then you are out of luck. You have to set it yourself on <code>TryGetValue</code>
failure. A typical implementation would be:</p>

<pre><code>    var result = MyDictionary.TryGetValue(&quot;key&quot;, var out value) 
        ? value
        : &quot;not found&quot;;
</code></pre>

<p>It is a minor annoyance but still a hassle. Our solution has always been
a homemade <code>GetValueOrDefault</code> extension method, something like this:</p>

<pre><code>    public static TValue GetValueOrDefault&lt;TKey, TValue&gt; 
        (this IDictionary&lt;TKey, TValue&gt; dictionary, TKey key, TValue defaultValue)
    {
        return dictionary.TryGetValue(key, var out value) 
            ? value
            : defaultValue;
    }
</code></pre>

<p>Usage:</p>

<pre><code>    var result = MyDictionary.GetValueOrDefault(&quot;key&quot;, &quot;not found&quot;);
</code></pre>

<p>We&rsquo;ve been using it since forever, and we are still using it even in recent
projects.</p>

<p>Today, as I was looking at something only tangentially related, I learned that
our extension method is obsolete, and it&rsquo;s been for a while. NetStandard
2.1 and NetCore 2 added a new extension method to the official API. It&rsquo;s
called, you guessed it, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions.getvalueordefault?view=net-5.0"><code>GetValueOrDefault</code></a>. It extends
<code>ÌReadOnlyDictionary&lt;TKey, TValue&gt;</code>, so it applies to all generic dictionaries,
which is cool.</p>

<p>We could continue with our extension method. It has the advantage of working
across all .NET platforms, not just recent ones. Implementations are likely
similar, and there’s probably little (if any) performance difference (I am too
lazy to compare). With NETCore (now NET5), APIs have not only acquired
cross-platform compatibility and improved performance but they have also been
expanded and amended, something often not very apparent. Not to me, at least.</p>

<p>The point I want to make here, I think, that nothing is set in stone. Today&rsquo;s
little event shows how my knowledge becomes stagnant over time. Setting apart
the time to learn new things is good, but acquired ones need sharping too.</p>

<p><em>Subscribe to the <a href="https://nicolaiarocci.substack.com">newsletter</a>, the <a href="https://nicolaiarocci.com/index.xml">RSS feed</a>, or follow @<a href="http://twitter.com/nicolaiarocci">nicolaiarocci</a> on Twitter</em></p>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="https://nicolaiarocci.com/" style="background-image: url(/images/avatar.png)"><span class="hidden">Nicola Iarocci's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="https://nicolaiarocci.com/">Nicola Iarocci</a></h4>
  
  <p>Read <a href="https://nicolaiarocci.com/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Ravenna, Italy</span>
    <span class="author-link icon-link"><a href="https://nicolaiarocci.com">https://nicolaiarocci.com</a></span>
  </div>
</section>




    


    







  </footer>
</article>

</main>


  <aside class="read-next">
  
  
      <a class="read-next-story prev" style="no-cover" href="/book-review-alpi-ribelli-storie-di-montagna-resistenza-e-utopia/">
          <section class="post">
              <h2>Book Review: Alpi Ribelli: Storie di montagna, resistenza e utopia</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Nicola Iarocci</a> All rights reserved</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

